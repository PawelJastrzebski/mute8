var y="https://paweljastrzebski.github.io/mute8-devtools/",d="MUTE-8-DEVTOOLS";var c=o=>localStorage.setItem(d,o),D=()=>localStorage.getItem(d);var p=()=>{},m=JSON.stringify,b=JSON.parse,I=o=>{try{return b(o)}catch{return null}},l=window,P=document,j=(o,t)=>{let e=t??{width:600,height:400},i=l.screenLeft!=null?l.screenLeft:screen.left,n=l.screenTop!=null?l.screenTop:screen.top,r=l.innerWidth,h=l.innerHeight,s=P.documentElement,a=r||(s.clientWidth?s.clientWidth:screen.width),w=h||(s.clientHeight?s.clientHeight:screen.height),f=i+(e.xMove??0),T=n+(e.yMove??0);(e.centered??!0)&&(f+=a/2-e.width/2,T+=w/2-e.height/2);let x=e.target??"_blank",g=l.open(o,x,`width=${e.width}, height=${e.height} top=${T}, left=${f}, ${e.options??"resize=yes"}`);return g!=null&&g.focus&&g.focus(),g},H=o=>new URL(o).origin,L=(o,t)=>{if(o.origin!=t)throw new Error(`Invalid message origin: ${o.origin}, allowed: ${t}`)},M=(o,t,e)=>{l.addEventListener("message",i=>{let n=I(i.data);n&&n.type&&n.i===o&&(L(i,t),e(i.source,n));},!1);},O=(o,t,e,i,n)=>{let r={i:e,j:n,type:i};o?.postMessage(m(r),t);},S=class{constructor(o,t="1",e){this.id=t,this.origin=H(o),setTimeout(()=>{this.child||(this.child=j(o,e));},250),M(this.id,this.origin,(i,n)=>{var r,h,s;n.type==="msg"&&((r=this.onMessage)==null||r.call(this,b(n.j))),n.type==="child-open"&&((h=this.onChildOpen)==null||h.call(this)),i&&this.child==null&&n.type==="ping"&&(this.child=i,(s=this.onChildAttach)==null||s.call(this),O(this.child,this.origin,t,"host-attach",""));}),setInterval(()=>{var i;if(this.child&&this.child.closed){(i=this.onChildClose)==null||i.call(this),this.child=null;return}},100);}origin;child;onMessage=p;onChildOpen=p;onChildAttach=p;onChildClose=p;isOpen(){return !!this.child&&this.child.closed==!1}post(o){O(this.child,this.origin,this.id,"msg",m(o));}};var v=o=>{for(let t of Object.keys(o)){let e=o[t];e&&typeof e=="object"&&v(e);}return Object.freeze(o)},R={logger:{logChange:!1,logInit:!0},deepFreaze:!0},C=()=>new Date().getTime(),u=class{enable=()=>{};disable=()=>localStorage.removeItem(d);sotrageRegistry=new Map;dialogHost;payloadBuffer=[];stateOverrides={};constructor(){let t=this;document.addEventListener("keydown",function(e){e.ctrlKey&&e.shiftKey&&e.code==="Digit8"&&(t.openDevTools(),e.preventDefault());});}register(t,e=R){let i=this;return n=>{let r=s=>i.setStateInit(t,s),h=(s,a)=>{i.setStateChanged(t,s,a);};return this.sotrageRegistry.set(t,{label:t,proxy:n,onInit:r,onChange:h}),{BInit:s=>(r(s),e.logger.logInit&&console.table({[`${t}-init`]:s}),e.deepFreaze?v(s):s),BUpdate:s=>{let a=i.stateOverrides[t];return a&&(s=a.state),e.deepFreaze&&(s=v(s)),s},AChange:(s,a)=>{h(s,a),e.logger.logChange&&console.table({[`${t}-old`]:s,[`${t}-new`]:a});}}}}openDevTools(){if(this.dialogHost&&this.dialogHost.isOpen()){this.dialogHost.child?.focus();return}this.dialogHost=new S(y,"devtools",{height:550,width:1e3}),this.dialogHost.onMessage=this.handleMessage.bind(this),this.dialogHost.onChildOpen=this.onDevToolsDialogsOpen.bind(this),this.dialogHost.onChildAttach=this.onDevToolsDialogsOpen.bind(this),this.dialogHost.onChildClose=this.onDevToolsDialogClose.bind(this);}postPayload(t){this.dialogHost?.post(t),this.payloadBuffer=this.payloadBuffer.concat(...t);}setStateInit(t,e){this.stateOverrides[t]||this.postPayload([{stateInit:{storageLabel:t,state:e,time:C()}}]);}setStateChanged(t,e,i){this.stateOverrides[t]||this.postPayload([{stateChanged:{storageLabel:t,oldState:e,newState:i,time:C()}}]);}onDevToolsDialogClose(){c("closed"),this.handleMessage([{stateOverrides:{}}]);}onDevToolsDialogsOpen(){c("open");let t=Array.from(this.sotrageRegistry.entries());this.dialogHost.post([{init:{definitions:t.map(([e,i])=>({label:e})),overrides:this.stateOverrides}},...this.payloadBuffer]);}handleMessage(t){for(let e of t)if(e.hostCommand==="refresh-host"&&window.location.reload(),e.stateOverrides){this.stateOverrides=e.stateOverrides??{};for(let[i,n]of this.sotrageRegistry.entries()){let r=this.stateOverrides[i];r&&(n.proxy.mut=r);}}}};(()=>{let o=window[d]=new u;D()=="open"&&o.openDevTools();})();
