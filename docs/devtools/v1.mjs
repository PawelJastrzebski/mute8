var y="https://paweljastrzebski.github.io/mute8-devtools/",d="MUTE-8-DEVTOOLS",c=i=>localStorage.setItem(d,i),T=()=>localStorage.getItem(d);var g=()=>{},O=JSON.stringify,C=JSON.parse,w=i=>{try{return C(i)}catch{return null}},l=window,I=document,A=(i,t)=>{let e=t??{width:600,height:400},s=l.screenLeft!=null?l.screenLeft:screen.left,r=l.screenTop!=null?l.screenTop:screen.top,o=l.innerWidth,n=l.innerHeight,a=I.documentElement,p=o||(a.clientWidth?a.clientWidth:screen.width),S=n||(a.clientHeight?a.clientHeight:screen.height),f=s+(e.xMove??0),m=r+(e.yMove??0);(e.centered??!0)&&(f+=p/2-e.width/2,m+=S/2-e.height/2);let x=e.target??"_blank",h=l.open(i,x,`width=${e.width}, height=${e.height} top=${m}, left=${f}, ${e.options??"resize=yes"}`);return h!=null&&h.focus&&h.focus(),h},j=i=>new URL(i).origin,H=(i,t)=>{if(i.origin!=t)throw new Error(`Invalid message origin: ${i.origin}, allowed: ${t}`)},L=(i,t,e)=>{l.addEventListener("message",s=>{let r=w(s.data);r&&r.type&&r.i===i&&(H(s,t),e(s.source,r));},!1);},D=(i,t,e,s,r)=>{let o={i:e,j:r,type:s};i?.postMessage(O(o),t);},b=class{constructor(i,t="1",e){this.id=t,this.origin=j(i),setTimeout(()=>{this.child||(this.child=A(i,e));},250),L(this.id,this.origin,(s,r)=>{var o,n,a;r.type==="msg"&&((o=this.onMessage)==null||o.call(this,C(r.j))),r.type==="child-open"&&((n=this.onChildOpen)==null||n.call(this)),s&&this.child==null&&r.type==="ping"&&(this.child=s,(a=this.onChildAttach)==null||a.call(this),D(this.child,this.origin,t,"host-attach",""));}),setInterval(()=>{var s;if(this.child&&this.child.closed){(s=this.onChildClose)==null||s.call(this),this.child=null;return}},100);}origin;child;onMessage=g;onChildOpen=g;onChildAttach=g;onChildClose=g;isOpen(){return !!this.child&&this.child.closed==!1}post(i){D(this.child,this.origin,this.id,"msg",O(i));}};var P=()=>new Date().getTime(),v=i=>{for(let t of Object.keys(i)){let e=i[t];e&&typeof e=="object"&&v(e);}return Object.freeze(i)},M={logger:{logChange:!1,logInit:!0},deepFreaze:!0},u=class{id=0;import=async()=>{};sotrageProxy=new Map;dialogHost;payloadBuffer=[];stateOverrides={};constructor(){let t=this;document.addEventListener("keydown",function(e){e.ctrlKey&&e.shiftKey&&e.code==="Digit8"&&(t.openDevTools(),e.preventDefault());});}register(t,e=M){let s=this;return r=>(this.sotrageProxy.set(t,r),{BI:o=>(s.setStateInit(t,o),e.logger.logInit&&console.table({[`${t}-init`]:o}),e.deepFreaze?v(o):o),BU:o=>{let n=s.stateOverrides[t];return n&&(o=n.state),e.deepFreaze&&(o=v(o)),o},AC:(o,n,a,p)=>{s.setStateChanged(t,o,n,a,p),e.logger.logChange&&console.table({[`${t}-old`]:o,[`${t}-new`]:n});}})}openDevTools(){if(this.dialogHost&&this.dialogHost.isOpen()){this.dialogHost.child?.focus();return}this.dialogHost=new b(y,"devtools",{height:550,width:1e3}),this.dialogHost.onMessage=this.handleMessage.bind(this),this.dialogHost.onChildOpen=this.onDevToolsDialogsOpen.bind(this),this.dialogHost.onChildAttach=this.onDevToolsDialogsOpen.bind(this),this.dialogHost.onChildClose=this.onDevToolsDialogClose.bind(this);}postPayload(t){this.dialogHost?.post(t),this.payloadBuffer=this.payloadBuffer.concat(...t);}setStateInit(t,e){this.stateOverrides[t]||this.postPayload([{stateInit:{id:++this.id,storageLabel:t,state:e,time:P()}}]);}setStateChanged(t,e,s,r,o){if(this.stateOverrides[t])return;let n=typeof o=="function"?{_fn:o+""}:o;this.postPayload([{stateChanged:{id:++this.id,storageLabel:t,actionName:r,args:n??[],oldState:e,state:s,time:P()}}]);}onDevToolsDialogClose(){c("closed"),this.handleMessage([{stateOverrides:{}}]);}onDevToolsDialogsOpen(){c("open");let t=Array.from(this.sotrageProxy.entries());this.dialogHost.post([{init:{definitions:t.map(([e,s])=>({label:e})),overrides:this.stateOverrides}},...this.payloadBuffer]);}handleMessage(t){for(let e of t)if(e.hostCommand==="refresh-host"&&window.location.reload(),e.stateOverrides){this.stateOverrides=e.stateOverrides??{};for(let[s,r]of this.sotrageProxy.entries()){let o=this.stateOverrides[s];o&&(r.mut=o);}}}};(()=>{let i=window[d]=new u;T()=="open"&&i.openDevTools();})();
