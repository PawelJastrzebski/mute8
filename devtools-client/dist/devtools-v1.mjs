var l="MUTE-8-DEVTOOLS",T=()=>localStorage.getItem(l),H=i=>localStorage.setItem(l,i),p=()=>localStorage.removeItem(l),O=async()=>{let i=await(await fetch("http://localhost:4040/devtools-v1.mjs")).text();H(i);},x=async i=>{if(!document.getElementById(l))return new Promise((e,t)=>{if(!(!document||!window)){var s=document.createElement("script");s.id=l,s.type="module",s.innerText=i,document.head.appendChild(s),setTimeout(e,30);}})},m=T();m&&(await x(m),O());var g=()=>{},D=JSON.stringify,C=JSON.parse,M=i=>{try{return C(i)}catch{return null}},h=window,j=document,W=(i,e)=>{let t=e??{width:600,height:400},s=h.screenLeft!=null?h.screenLeft:screen.left,n=h.screenTop!=null?h.screenTop:screen.top,r=h.innerWidth,d=h.innerHeight,o=j.documentElement,a=r||(o.clientWidth?o.clientWidth:screen.width),b=d||(o.clientHeight?o.clientHeight:screen.height),f=s+(t.xMove??0),y=n+(t.yMove??0);(t.centered??!0)&&(f+=a/2-t.width/2,y+=b/2-t.height/2);let A=t.target??"_blank",c=h.open(i,A,`width=${t.width}, height=${t.height} top=${y}, left=${f}, ${t.options??"resize=yes"}`);return c!=null&&c.focus&&c.focus(),c},E=i=>new URL(i).origin,L=(i,e)=>{if(i.origin!=e)throw new Error(`Invalid message origin: ${i.origin}, allowed: ${e}`)},R=(i,e,t)=>{h.addEventListener("message",s=>{let n=M(s.data);n&&n.type&&n.i===i&&(L(s,e),t(s.source,n));},!1);},w=(i,e,t,s,n)=>{let r={i:t,j:n,type:s};i?.postMessage(D(r),e);},I=class{constructor(i,e="1",t){this.id=e,this.origin=E(i),setTimeout(()=>{this.child||(this.child=W(i,t));},250),R(this.id,this.origin,(s,n)=>{var r,d,o;n.type==="msg"&&((r=this.onMessage)==null||r.call(this,C(n.j))),n.type==="child-open"&&((d=this.onChildOpen)==null||d.call(this)),s&&this.child==null&&n.type==="ping"&&(this.child=s,(o=this.onChildAttach)==null||o.call(this),w(this.child,this.origin,e,"host-attach",""));}),setInterval(()=>{var s;if(this.child&&this.child.closed){(s=this.onChildClose)==null||s.call(this),this.child=null;return}},100);}origin;child;onMessage=g;onChildOpen=g;onChildAttach=g;onChildClose=g;isOpen(){return !!this.child&&this.child.closed==!1}post(i){w(this.child,this.origin,this.id,"msg",D(i));}};var u=i=>{for(let e of Object.keys(i)){let t=i[e];t&&typeof t=="object"&&u(t);}return Object.freeze(i)},$={logger:{logChange:!1,logInit:!0},deepFreaze:!0},P=()=>new Date().getTime(),S=i=>localStorage.setItem("dev-tools-opne",i),U=()=>localStorage.getItem("dev-tools-opne"),z="https://paweljastrzebski.github.io/mute8-devtools/",v=class{enable=()=>{};disable=()=>p();sotrageRegistry=new Map;dialogHost;payloadBuffer=[];stateOverrides={};constructor(){let e=this;document.addEventListener("keydown",function(t){t.ctrlKey&&t.shiftKey&&t.code==="Digit8"&&(e.openDevTools(),t.preventDefault());});}register(e,t=$){let s=this;return n=>{let r=o=>s.setStateInit(e,o),d=(o,a)=>{s.setStateChanged(e,o,a);};return this.sotrageRegistry.set(e,{label:e,proxy:n,onInit:r,onChange:d}),{BInit:o=>(r(o),t.logger.logInit&&console.table({[`${e}-init`]:o}),t.deepFreaze?u(o):o),BUpdate:o=>{let a=s.stateOverrides[e];return a&&(o=a.state),t.deepFreaze&&(o=u(o)),o},AChange:(o,a)=>{d(o,a),t.logger.logChange&&console.table({[`${e}-old`]:o,[`${e}-new`]:a});}}}}openDevTools(){if(this.dialogHost&&this.dialogHost.isOpen()){this.dialogHost.child?.focus();return}this.dialogHost=new I(z,"devtools",{height:550,width:1e3}),this.dialogHost.onMessage=this.handleMessage.bind(this),this.dialogHost.onChildOpen=this.onDevToolsDialogsOpen.bind(this),this.dialogHost.onChildAttach=this.onDevToolsDialogsOpen.bind(this),this.dialogHost.onChildClose=this.onDevToolsDialogClose.bind(this);}postPayload(e){this.dialogHost?.post(e),this.payloadBuffer=this.payloadBuffer.concat(...e);}setStateInit(e,t){this.stateOverrides[e]||this.postPayload([{stateInit:{storageLabel:e,state:t,time:P()}}]);}setStateChanged(e,t,s){this.stateOverrides[e]||this.postPayload([{stateChanged:{storageLabel:e,oldState:t,newState:s,time:P()}}]);}onDevToolsDialogClose(){S("closed"),this.handleMessage([{stateOverrides:{}}]);}onDevToolsDialogsOpen(){S("open");let e=Array.from(this.sotrageRegistry.entries());this.dialogHost.post([{init:{definitions:e.map(([t,s])=>({label:t})),overrides:this.stateOverrides}},...this.payloadBuffer]);}handleMessage(e){for(let t of e)if(t.hostCommand==="refresh-host"&&window.location.reload(),t.stateOverrides){this.stateOverrides=t.stateOverrides??{};for(let[s,n]of this.sotrageRegistry.entries()){let r=this.stateOverrides[s];r&&(n.proxy.mut=r);}}}};(()=>{let i=window[l]=new v;U()=="open"&&i.openDevTools();})();
