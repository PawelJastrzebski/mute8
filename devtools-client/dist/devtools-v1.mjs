var d=()=>{},f=JSON.stringify,v=JSON.parse,h=window,C=document,I=(i,t)=>{let e=t??{width:600,height:400},s=h.screenLeft!=null?h.screenLeft:screen.left,o=h.screenTop!=null?h.screenTop:screen.top,l=h.innerWidth,n=h.innerHeight,r=C.documentElement,m=l||(r.clientWidth?r.clientWidth:screen.width),w=n||(r.clientHeight?r.clientHeight:screen.height),p=s+(e.xMove??0),u=o+(e.yMove??0);(e.centered??!0)&&(p+=m/2-e.width/2,u+=w/2-e.height/2);let O=e.target??"_blank",a=h.open(i,O,`width=${e.width}, height=${e.height} top=${u}, left=${p}, ${e.options??"resize=yes"}`);return a!=null&&a.focus&&a.focus(),a},H=i=>new URL(i).origin,M=(i,t)=>{if(i.origin!=t)throw new Error(`Invalid message origin: ${i.origin}, allowed: ${t}`)},P=(i,t,e)=>{h.addEventListener("message",s=>{M(s,t);let o=v(s.data);o&&o.i===i&&e(s.source,o);},!1);},y=(i,t,e,s,o)=>{let l={i:e,j:o,type:s};i?.postMessage(f(l),t);},T=class{constructor(i,t="1",e){this.id=t,this.origin=H(i),setTimeout(()=>{this.child||(this.child=I(i,e));},250),P(this.id,this.origin,(s,o)=>{var l,n,r;o.type==="msg"&&((l=this.onMessage)==null||l.call(this,v(o.j))),o.type==="child-open"&&((n=this.onChildOpen)==null||n.call(this)),s&&this.child==null&&o.type==="ping"&&(this.child=s,(r=this.onChildAttach)==null||r.call(this),y(this.child,this.origin,t,"host-attach",""));}),setInterval(()=>{var s;if(this.child&&this.child.closed){(s=this.onChildClose)==null||s.call(this),this.child=null;return}},100);}origin;child;onMessage=d;onChildOpen=d;onChildAttach=d;onChildClose=d;isOpen(){return !!this.child&&this.child.closed==!1}post(i){y(this.child,this.origin,this.id,"msg",f(i));}};var c=i=>{for(let t of Object.keys(i)){let e=i[t];e&&typeof e=="object"&&c(e);}return Object.freeze(i)},x={logger:{logChange:!0,logInit:!0},deepFreaze:!0},g=class{fullClientUrl="";loaded=!0;async enable(){}Mute8DevToolsUIUrl="http://localhost:4030";sotrageRegistry=new Map;dialogHost;constructor(){let t=this;document.addEventListener("keydown",function(e){e.ctrlKey&&e.shiftKey&&e.code==="Digit8"&&(t.openDevTools(),e.preventDefault());});}register(t,e=x){return s=>{let o=n=>{},l=(n,r)=>{};return this.sotrageRegistry.set(t,{label:t,proxy:s,onInit:o,onChange:l}),{BInit:n=>(e.logger.logInit&&console.table({[`${t}-init`]:n}),e.deepFreaze?c(n):n),BUpdate:n=>e.deepFreaze?c(n):n,AChange:(n,r)=>{e.logger.logChange&&console.table({[`${t}-old`]:n,[`${t}-new`]:r});}}}}openDevTools(){if(this.dialogHost&&this.dialogHost.isOpen()){this.dialogHost.child?.focus();return}console.log("opening"),this.dialogHost=new T(this.Mute8DevToolsUIUrl,"devtools",{height:400,width:600}),this.dialogHost.onMessage=t=>{console.log(t);},setInterval(()=>{this.dialogHost?.post({test:"OK"});},1500);}},A=()=>{window["mut8-DevTools"]=new g;};A();
